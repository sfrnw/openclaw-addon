# OpenClaw Official Docker Setup - Research Summary

## Official Docker Flow (from docs.openclaw.ai/install/docker)

### Quick Start
```bash
./docker-setup.sh
```

This script:
- Builds the gateway image
- Runs the onboarding wizard
- Starts the gateway via Docker Compose
- Generates a gateway token and writes it to `.env`

### Manual Flow
```bash
docker build -t openclaw:local -f Dockerfile .
docker compose run --rm openclaw-cli onboard
docker compose up -d openclaw-gateway
```

### Config Location
- `~/.openclaw/` - Configuration
- `~/.openclaw/workspace` - Workspace

### Environment Variables
- `OPENCLAW_DOCKER_APT_PACKAGES` - Extra apt packages during build
- `OPENCLAW_EXTRA_MOUNTS` - Extra host bind mounts
- `OPENCLAW_HOME_VOLUME` - Persist `/home/node` in named volume

### Control UI
- URL: `http://127.0.0.1:18789/`
- Token: Generated by setup script, stored in `.env`

### Channel Setup
```bash
# WhatsApp (QR)
docker compose run --rm openclaw-cli channels login

# Telegram (bot token)
docker compose run --rm openclaw-cli channels add --channel telegram --token "<token>"
```

## Key Learnings

1. **Official Docker uses docker-compose** with separate gateway and CLI services
2. **Config is mounted** from host `~/.openclaw/` into container
3. **Onboarding is interactive** - runs via CLI container
4. **Gateway token is generated** automatically and stored in `.env`
5. **Channels are configured via CLI** commands, not environment variables

## Home Assistant Add-on Implications

For HA add-on, we need to:
1. Use the official Docker image or build from same Dockerfile
2. Mount config from `/data` to `/home/node/.openclaw`
3. Run onboarding once (or skip if config exists)
4. Configure channels via CLI commands after startup
5. Gateway token should be generated automatically

## Recommended Add-on Structure

```yaml
# config.json
{
  "options": {
    "telegram_token": "",
    "gateway_token": ""
  },
  "schema": {
    "telegram_token": "str",
    "gateway_token": "str"
  }
}
```

```bash
# run.sh
# 1. Check if config exists
# 2. If not, generate minimal config
# 3. If telegram_token provided, configure channel
# 4. Start gateway
```
